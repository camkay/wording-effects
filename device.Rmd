---
title: "Device effects"
date: "Last updated `r Sys.Date()`"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
---


```{r, include = FALSE}
knitr::opts_chunk$set(warning = F, message = F)
```

```{r, echo = F}
library(here) # for working with files
library(tidyverse) # for cleaning
library(janitor) # for variable names
library(lme4) # for mulitlevel modeling
library(lmerTest) # for df and p-values
library(emmeans) # for pairwise comparisons
library(sjPlot) # for figures
library(ggpubr) # for prettier plots
library(kableExtra) # for nicer tables
```

```{r, echo = F}
load(here("data/items_df.Rds"))
```


## Responses

### Response by device

We used a multilevel model, nesting response within participant to account for dependence. Our primary predictor was device format. Here, we use data from blocks 1 and 2.

```{r}
items_12 = items_df %>% filter(block %in% c("1","2"))
```

```{r}
mod.response = lmer(response~devicetype + (1|proid), 
                  data = items_12)
anova(mod.response)

```

```{r, fig.cap = "Predicted response on personality items by condition."}
plot1 = plot_model(mod.response, type = "pred") 

plot1$devicetype +
  labs(x = NULL,
       y = "Average response",
       title = "Average responses by device") +
  theme_pubclean()
```

```{r, fig.cap = "Distribution of responses by category"}
means_by_group = items_12 %>%
  group_by(devicetype) %>% 
  summarise(m = mean(response),
            s = sd(response))

items_12 %>%
  ggplot(aes(x = response)) +
  geom_histogram(aes(fill = block),
                 position = "dodge",
                 bins = 6, color = "white") +
  geom_vline(aes(xintercept = m), 
             data = means_by_group) +
  facet_wrap(~devicetype, scales = "free_y") +
  #guides(fill = "none") +
  scale_x_continuous(breaks = 1:6) +
  labs(y = "Number of particpants",
       title = "Distribution of responses by format") +
  theme_pubr()
```

### Device by format

```{r}
mod.response2 = lmer(response~devicetype*format + (1|proid), 
                  data = items_12)
anova(mod.response2)

```

```{r, fig.cap = "Predicted response on personality items by condition."}
plot2 = plot_model(mod.response2, type = "pred", terms = c("format", "devicetype")) 

plot2 +
  labs(x = NULL,
       y = "Average response",
       title = "Average responses by device") +
  theme_pubclean()
```

## Timing

### Timing by device

We used a multilevel model, nesting timing within participant to account for dependence. Our primary predictor was format.

```{r}
mod.timing = lmer(seconds_log~devicetype + (1|proid), 
                  data = items_12)
anova(mod.timing)
```

```{r, fig.cap = "Predicted timing on personality items by condition."}
plot1 = plot_model(mod.timing, type = "pred") 

plot1$devicetype +
  labs(x = NULL,
       y = "timing (log)",
       title = "Average timing time by device type") +
  theme_pubclean()
```

```{r, fig.cap = "Distribution of secondss by category"}
means_by_group = items_12 %>%
  group_by(devicetype) %>% 
  summarise(m = mean(timing),
            s = sd(timing))

items_12 %>%
  ggplot(aes(x = timing, fill = devicetype)) +
  geom_histogram(bins = 100) +
  geom_vline(aes(xintercept = m), data = means_by_group) +
  facet_wrap(~devicetype, scales = "free_y") +
  guides(fill = "none") +
  scale_x_log10() +
  labs(y = "Number of particpants",
       title = "Distribution of timing by format",
       x = "timing (logrithmic scale)") +
  theme_pubr()
```

### Device by format

```{r}
mod.timing2 = lmer(seconds_log~devicetype*format + (1|proid), 
                  data = items_12)
anova(mod.timing2)
```

```{r, fig.cap = "Predicted timing on personality items by condition."}
plot1 = plot_model(mod.timing2, type = "pred", terms = c("format", "devicetype")) 

plot1 +
  labs(x = NULL,
       y = "timing (log)",
       title = "Average timing time by device type") +
  theme_pubclean()
```
