---
title: "Does item format impact response?"
date: "Last updated `r Sys.Date()`"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
---

The primary aims of this study are to evaluate the effects of item wording in online, self-report personality assessment. Specifically, we intend to consider the extent to which incremental wording changes may influence differences in the distributions of responses, response times, and psychometric properties of the items. These wording changes will include a progression from using (1) trait-descriptive adjectives by themselves, (2) with the linking verb “to be” (Am…), (3) with the additional verb “to tend” (Tend to be...), and (4) with the pronoun “someone” (Am someone who tends to be…). 

Using a protocol that administers each adjective twice to the same participant (in different combinations of item format administered randomly across participants), we will use between-person analyses to compare responses using group-level data for the different formats. 

These analyses will attempt to account for delayed_memory effects by collecting data on immediate and delayed recall (5 minutes and approximately two weeks) using a delayed_memory paradigm that was developed based on a similar recall task used in the HRS (Runge et al., 2015).


```{r, include = FALSE}
knitr::opts_chunk$set(warning = F, message = F)
```

```{r, echo = F}
library(here) # for working with files
library(tidyverse) # for cleaning
library(janitor) # for variable names
library(lme4) # for mulitlevel modeling
library(lmerTest) # for p-values
library(emmeans) # for comparisons
library(sjPlot) # for figures
library(ggpubr) # for prettier plots
library(kableExtra) # for nicer tables
```

```{r, echo = F}
load(here("data/items_df.Rds"))
```

## Analysis: Block 1 data only

We used a multilevel model, nesting response within participant to account for dependence. Our primary predictor was format. Here, we use only Block 1 data.

```{r}
item_block1 = filter(items_df, block == "1")

mod.format_b1 = lmer(response~format + (1|proid), 
                  data = item_block1)
anova(mod.format_b1)
```

```{r, echo = F}
# save for power analysis
save(mod.format_b1, file = here("objects/mod_format_b1.Rdata"))
```


```{r, fig.cap = "Predicted response on personality items by condition, using only Block 1 data."}
plot_b1 = plot_model(mod.format_b1, type = "pred") 

plot_b1$format +
  labs(x = NULL,
       y = "Average response",
       title = "Average responses by item formatting (Block 1 Data)") +
  theme_pubclean()
```

```{r, fig.cap = "Distribution of responses by category, block 1 data only"}
means_by_group = item_block1 %>%
  group_by(format) %>% 
  summarise(m = mean(response),
            s = sd(response))

item_block1 %>%
  ggplot(aes(x = response, fill = format)) +
  geom_histogram(bins = 6, color = "white") +
  geom_vline(aes(xintercept = m), data = means_by_group) +
  geom_text(aes(x = 1, 
                y = 125, 
                label = paste("M =", round(m,2), 
                              "\nSD =", round(s,2))), 
            data = means_by_group, 
            hjust =0, 
            vjust = 1) +
  facet_wrap(~format) +
  guides(fill = "none") +
  scale_x_continuous(breaks = 1:6) +
  labs(y = "Number of particpants",
       title = "Distribution of responses by format (Block 1 data)") +
  theme_pubr()
```

### One model for each adjective

We can also repeat this analysis separately for each trait. 

```{r, results = 'asis'}
mod_by_item_b1 = item_block1 %>%
  group_by(item) %>%
  nest() %>%
  mutate(mod = map(data, ~lm(response~format, data = .))) %>%
  mutate(aov = map(mod, anova)) 

summary_by_item_b1 = mod_by_item_b1 %>%
  mutate(tidy = map(aov, broom::tidy)) %>%
  select(item, tidy) %>% 
  unnest(cols = c(tidy)) %>%
  filter(term == "format") %>%
  select(-term, -df) %>% 
  mutate(p.adj = p.adjust(p.value, method = "holm")) 

summary_by_item_b1 %>%
  mutate(across(
    starts_with("p"),
    papaja::printnum
  )) %>%
  kable(digits = 2, booktabs = T, caption = "Format effects on response by item (block 1 data only)") %>%
  kable_styling()
```

### Pairwise t-tests for significant ANOVAs

Here we identify the specific items with significant differences.

```{r}
sig_item_b1 = summary_by_item_b1 %>%
  filter(p.value < .05) 

sig_item_b1 = sig_item_b1$item
sig_item_b1
```

Then we create models for each adjective. We use the `emmeans` package to perform pairwise comparisons, again with a Holm correction on the _p_-values. We also plot the means and 95% confidence intervals of each mean. 

**This code will have to be changed after final data collection. It is not self-adapting!**

### Talkative

```{r, results = 'asis'}
talkative_model_b1 = item_block1 %>%
  filter(item == "talkative") %>%
  lm(response~format, data = .)

talkative_em_b1 = emmeans(talkative_model_b1, "format")
pairs(talkative_em_b1, adjust = "holm") %>%
  kable(booktabs = T,
        digits = c(0,2,2,2,2,3),
        caption = "Differences in response to Talkative by format (Block 1 data only)",
        col.names = c("Contrast", "Difference in means", "SE", "df", "t", "p")) %>%
  kable_styling()
```

```{r, fig.cap = "Average response to \"talkative\" by format (block 1 data only)" }
plot_model(talkative_model_b1, type = "pred", terms = c("format"))
```

## Analysis: Block 1 and Block 2

We used a multilevel model, nesting response within participant to account for dependence. Our primary predictor was format. Here, we use only Block 1 data.

```{r}
mod.format_b2 = lmer(response~format + (1|proid), 
                  data = items_df)
anova(mod.format_b2)
```

```{r, echo = F}
# save for power analysis
save(mod.format_b2, file = here("objects/mod_format_b2.Rdata"))
```


```{r, fig.cap = "Predicted response on personality items by condition, using only Block 1 data."}
plot_b2 = plot_model(mod.format_b2, type = "pred") 

plot_b2$format +
  labs(x = NULL,
       y = "Average response",
       title = "Average responses by item formatting (Block 1 and Block 2)") +
  theme_pubclean()
```

```{r, fig.cap = "Distribution of responses by category, block 1 and block 2"}
means_by_group = items_df %>%
  group_by(format) %>% 
  summarise(m = mean(response),
            s = sd(response))

items_df %>%
  ggplot(aes(x = response, fill = format)) +
  geom_histogram(bins = 6, color = "white") +
  geom_vline(aes(xintercept = m), data = means_by_group) +
  geom_text(aes(x = 1, 
                y = 200, 
                label = paste("M =", round(m,2), 
                              "\nSD =", round(s,2))), 
            data = means_by_group, 
            hjust =0, 
            vjust = 1) +
  facet_wrap(~format) +
  guides(fill = "none") +
  scale_x_continuous(breaks = 1:6) +
  labs(y = "Number of particpants",
       title = "Distribution of responses by format (Block 1 and Block 2)") +
  theme_pubr()
```

### One model for each adjective

We can also repeat this analysis separately for each trait. 

```{r, results = 'asis'}
mod_by_item_b2 = items_df %>%
  group_by(item) %>%
  nest() %>%
  mutate(mod = map(data, ~lmer(response~format + (1|proid), data = .))) %>%
  mutate(aov = map(mod, anova)) 

summary_by_item_b2 = mod_by_item_b2 %>%
  mutate(tidy = map(aov, broom::tidy)) %>%
  select(item, tidy) %>% 
  unnest(cols = c(tidy)) %>%
  filter(term == "format") %>%
  select(-term) %>% 
  mutate(p.adj = p.adjust(p.value, method = "holm")) 

summary_by_item_b2 %>%
  mutate(across(
    starts_with("p"),
    papaja::printnum
  )) %>%
  kable(digits = 2, booktabs = T, caption = "Format effects on response by item (block 1 data only)") %>%
  kable_styling()
```

### Pairwise t-tests for significant ANOVAs

Here we identify the specific items with significant differences.

```{r}
sig_item_b2 = summary_by_item_b2 %>%
  filter(p.value < .05) 

sig_item_b2 = sig_item_b2$item
sig_item_b2
```

Then we create models for each adjective. We use the `emmeans` package to perform pairwise comparisons, again with a Holm correction on the _p_-values. We also plot the means and 95% confidence intervals of each mean. 

**This code will have to be changed after final data collection. It is not self-adapting!**

### Careless

```{r, results = 'asis'}
careless_model_b2 = items_df %>%
  filter(item == "careless") %>%
  lmer(response~format + (1|proid), 
                               data = .)

careless_em_b2 = emmeans(careless_model_b2, "format")
pairs(careless_em_b2, adjust = "holm") %>%
  kable(booktabs = T,
        digits = c(0,2,2,2,2,3),
        caption = "Differences in response to Careless by format (Block 1 and Block 2)",
        col.names = c("Contrast", "Difference in means", "SE", "df", "t", "p")) %>%
  kable_styling()
```

```{r, fig.cap = "Average response to \"careless\" by format (Block 1 and Block 2)" }
plot_model(careless_model_b2, type = "pred", terms = c("format"))
```

### Thrifty

```{r, results = 'asis'}
thrifty_model_b2 = items_df %>%
  filter(item == "thrifty") %>%
  lmer(response~format + (1|proid), 
                               data = .)

thrifty_em_b2 = emmeans(thrifty_model_b2, "format")
pairs(thrifty_em_b2, adjust = "holm") %>%
  kable(booktabs = T,
        digits = c(0,2,2,2,2,3),
        caption = "Differences in response to Thifty by format (Block 1 and Block 2)",
        col.names = c("Contrast", "Difference in means", "SE", "df", "t", "p")) %>%
  kable_styling()
```

```{r, fig.cap = "Average response to \"thrifty\" by format (Block 1 and Block 2)" }
plot_model(thrifty_model_b2, type = "pred", terms = c("format"))
```

## Analysis: Account for memory effects


```{r}
mod.format_mem = lmer(response~format*delayed_memory + (1|proid), 
                  data = items_df)
anova(mod.format_mem)
summary(mod.format_mem)
```


```{r, fig.cap = "Predicted response on personality items by condition after controlling for delayed_memory."}
plot_model(mod.format_mem, 
           type = "pred", 
           term = c("format", "delayed_memory[meansd]")) +
  geom_line() +
  labs(x = NULL, 
       y = "Average response") +
  scale_color_discrete("Memory", labels = c("-1SD", "Mean", "+1SD"))+
  theme_pubclean()
```

### One model for each adjective

```{r, results = 'asis'}
mod_by_item_mem = items_df %>%
  group_by(item) %>%
  nest() %>%
  mutate(mod = map(data, ~lm(response~format*delayed_memory, data = .))) %>%
  mutate(aov = map(mod, anova)) 

summary_by_item_mem = mod_by_item_mem %>%
  mutate(tidy = map(aov, broom::tidy)) %>%
  select(item, tidy) %>% 
  unnest(cols = c(tidy)) %>%
  filter(term == "format:delayed_memory") %>%
  select(-term, -df) %>% 
  mutate(p.adj = p.adjust(p.value, method = "holm"))

summary_by_item_mem %>%
  mutate(across(
    starts_with("p"),
    papaja::printnum
  )) %>%
  kable(digits = 2, booktabs = T) %>%
  kable_styling()
```

### Pairwise t-tests for significant ANOVAs

Here we identify the specific items with significant differences.

```{r}
sig_item_mem = summary_by_item_mem %>%
  filter(p.value < .05) 

sig_item_mem = sig_item_mem$item
sig_item_mem
```